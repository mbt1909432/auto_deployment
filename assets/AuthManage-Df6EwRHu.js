var x=(p,C,f)=>new Promise((m,g)=>{var r=i=>{try{_(f.next(i))}catch(h){g(h)}},v=i=>{try{_(f.throw(i))}catch(h){g(h)}},_=i=>i.done?m(i.value):Promise.resolve(i.value).then(r,v);_((f=f.apply(p,C)).next())});import{I as L,x as U,_ as z}from"./index-YxwiwpWh.js";import{e as S}from"./tree-D8D4nCL3.js";/* empty css                   *//* empty css                   *//* empty css                 *//* empty css               *//* empty css                *//* empty css                  */import{u as F}from"./dict-CgALl-GC.js";import{c as J}from"./menu-CcmDVv2h.js";import{c as P}from"./dept-D9OxYoIk.js";import{p as q}from"./role-DxVHGvrX.js";import{A as B,B as G,r as T,C as W,D as X,F as Q,G as I,H as Y,I as Z,b as A}from"./element-plus-c7Yb662V.js";import{l as $,a as c,b as ee,ah as te,m as k,p as O,O as n,R as u,u as e,q as o,W as ae,V as se,P as oe,a7 as le,S as ne,X as re,aH as ie,aI as de,n as M}from"./vue-chunks-DM5Q6aJS.js";import"./dict-C2OSXRrB.js";const V=p=>(ie("data-v-d826b062"),p=p(),de(),p),ce={class:"auth-manage-main-view"},ue={class:"flex justify-between pt-[20px] pb-[20px]"},pe=V(()=>o("span",null,"权限管理",-1)),me={class:"h-12 flex justify-between mt-3 mr-3 ml-5"},fe={class:"mt-1 text-[#909399]"},ve={class:"border-r-1 border-r-[#f0f0f0] b-r-solid h-[100%] p-[20px] box-border"},_e=V(()=>o("div",{class:"flex items-center"},[o("div",{class:"yxt-divider"}),o("span",null,"数据权限")],-1)),he={class:"ml-4 mt-3"},be={key:0,class:"mt-3 max-h-[65vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto"},ye=V(()=>o("div",{class:"flex items-center"},[o("div",{class:"yxt-divider"}),o("span",null,"菜单权限")],-1)),xe={class:"mt-5 max-h-[70vh] b-1 b-solid b-[#e5e7eb] p-10px overflow-auto box-border"},ge=$({__name:"AuthManage",props:{currentRow:{type:Object,default:()=>null}},emits:["getList"],setup(p,{expose:C,emit:f}){const m=p,g=f,r=c({});ee(()=>m.currentRow,a=>{a&&(r.value=JSON.parse(JSON.stringify(a)))},{deep:!0,immediate:!0});const v=c(!1),_=c(),i=()=>x(this,null,function*(){const t=yield F().getDictObj(["sys_vadmin_data_range"]);_.value=t.sys_vadmin_data_range}),h={children:"children",label:"label"};let D=c([]);const w=c(),N=()=>x(this,null,function*(){var t;const a=yield P();if(a&&(D.value=a.data,yield M(),m.currentRow)){const d=m.currentRow.depts.map(l=>l.id),s=[];S(a.data,l=>{d.includes(l.value)&&s.push(l.value)});for(const l of s)(t=e(w))==null||t.setChecked(l,!0,!1)}});let E=c([]);const b=c(),K=()=>x(this,null,function*(){var t;const a=yield J();if(a&&(E.value=a.data,yield M(),m.currentRow)){const d=m.currentRow.menus.map(l=>l.id),s=[];S(a.data,l=>{d.includes(l.value)&&s.push(l.value)});for(const l of s)(t=e(b))==null||t.setChecked(l,!0,!1)}}),y=c(!1),j=()=>x(this,null,function*(){var t,d,s;if(y.value)return;if(U(r.value.data_range)){A.error("数据范围选择项不能为空！");return}y.value=!0;const a=[...((t=e(b))==null?void 0:t.getCheckedKeys())||[],...((d=e(b))==null?void 0:d.getHalfCheckedKeys())||[]];r.value.menu_ids=a,r.value.dept_ids=(s=e(w))==null?void 0:s.getCheckedKeys();try{(yield q(r.value))&&(y.value=!1,A.success("保存成功"),R(),g("getList"))}finally{y.value=!1}}),H=()=>{v.value=!0,K(),N()},R=()=>{var a,t;v.value=!1,r.value={},(a=e(b))==null||a.setCheckedKeys([]),(t=e(w))==null||t.setCheckedKeys([])};return i(),C({openDrawer:H}),(a,t)=>{const d=te("BaseButton");return k(),O("div",ce,[n(e(Z),{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s),"with-header":!1,size:1e3,"before-close":R},{default:u(()=>[n(e(B),null,{default:u(()=>[n(e(G),null,{default:u(()=>[o("div",ue,[pe,o("span",{onClick:R,class:"flex cursor-pointer"},[n(e(L),{icon:"iconamoon:close-thin",size:23})])])]),_:1}),n(e(T)),o("div",me,[o("div",fe,[o("span",null,"角色名称："+ae(r.value.name),1)]),n(d,{type:"primary",loading:y.value,onClick:j},{default:u(()=>[se("保存")]),_:1},8,["loading"])]),n(e(T)),n(e(B),null,{default:u(()=>[n(e(W),{width:"450px"},{default:u(()=>[o("div",ve,[o("div",null,[_e,o("div",he,[n(e(X),{modelValue:r.value.data_range,"onUpdate:modelValue":t[0]||(t[0]=s=>r.value.data_range=s),placeholder:"请选择数据范围"},{default:u(()=>[(k(!0),O(oe,null,le(_.value,s=>(k(),ne(e(Q),{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r.value.data_range==="3"?(k(),O("div",be,[n(e(I),{ref_key:"deptTreeRef",ref:w,data:e(D),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!0},null,8,["data"])])):re("",!0)])])])]),_:1}),n(e(Y),null,{default:u(()=>[ye,o("div",xe,[n(e(I),{ref_key:"menuTreeRef",ref:b,data:e(E),"show-checkbox":"","node-key":"value",props:h,"default-expand-all":!0,"check-strictly":!1},null,8,["data"])])]),_:1})]),_:1})]),_:1}),n(e(T))]),_:1},8,["modelValue"])])}}}),je=z(ge,[["__scopeId","data-v-d826b062"]]);export{je as default};
